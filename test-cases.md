# TML Villa 端到端测试用例

## 测试范围
F009 (用户中心)、F010 (评价系统)、F011 (消息通知)、F013 (成本核算)、F017 (搜索优化)、F018 (收藏功能)、F019 (多语言)、F020 (移动端适配)、F021 (错误边界)

---

## F009 - 用户中心

### TC-F009-001: 用户中心页面加载
**前置条件**: 用户已登录
**测试步骤**:
1. 访问用户中心页面 `/#/user-center`
2. 检查页面元素是否完整加载

**预期结果**:
- ✅ 显示用户头像和基本信息
- ✅ 显示5个标签页：个人资料、我的订单、消息通知、我的收藏、我的评价
- ✅ 显示用户统计：订单数量、消息数量、收藏数量、评价数量

### TC-F009-002: 个人信息编辑
**前置条件**: 用户已登录
**测试步骤**:
1. 点击"编辑资料"按钮
2. 修改用户名
3. 保存修改

**预期结果**:
- ✅ 弹出编辑表单
- ✅ 可以修改用户名、手机号
- ✅ 保存后信息更新

### TC-F009-003: 修改密码
**前置条件**: 用户已登录
**测试步骤**:
1. 点击"修改密码"按钮
2. 输入旧密码、新密码、确认密码
3. 提交修改

**预期结果**:
- ✅ 弹出密码修改表单
- ✅ 验证旧密码
- ✅ 新密码和确认密码一致验证
- ✅ 修改成功后提示

### TC-F009-004: 我的订单查看
**前置条件**: 用户已登录
**测试步骤**:
1. 点击"我的订单"标签
2. 查看订单列表

**预期结果**:
- ✅ 显示订单列表
- ✅ 显示订单状态、金额、日期
- ✅ 可以点击订单查看详情

### TC-F009-005: 未登录访问用户中心
**测试步骤**:
1. 清除登录状态
2. 访问用户中心页面

**预期结果**:
- ✅ 重定向到登录页面
- ✅ 登录成功后返回用户中心

---

## F010 - 评价系统

### TC-F010-001: 民宿详情页评价展示
**测试步骤**:
1. 打开任意民宿详情页 `/#/homestay/:id`
2. 滚动到评价区域

**预期结果**:
- ✅ 显示评价标题"Reviews"
- ✅ 显示综合评分（如 4.8）
- ✅ 显示评价数量（如 96 reviews）
- ✅ 评价列表正常显示

### TC-F010-002: 我的评价查看
**前置条件**: 用户已登录
**测试步骤**:
1. 进入用户中心
2. 点击"我的评价"标签

**预期结果**:
- ✅ 显示用户发表的评价列表
- ✅ 显示评价的民宿名称、评分、内容、日期
- ✅ 可以删除自己的评价

### TC-F010-003: 创建评价（需要已完成订单）
**前置条件**: 用户有已完成的订单
**测试步骤**:
1. 进入用户中心 -> 我的订单
2. 找到已完成的订单
3. 点击"评价"按钮
4. 选择星级（1-5星）
5. 输入评价内容（最多200字）
6. 上传图片（最多3张）
7. 提交评价

**预期结果**:
- ✅ 只有已完成的订单才能评价
- ✅ 星级评分1-5星可选
- ✅ 内容限制200字
- ✅ 图片最多3张
- ✅ 提交成功后显示在评价列表

### TC-F010-004: 评价字数限制
**测试步骤**:
1. 打开评价表单
2. 输入超过200字的内容

**预期结果**:
- ✅ 输入被限制在200字以内
- ✅ 显示剩余字数提示

### TC-F010-005: 管理员回复评价
**前置条件**: 管理员已登录
**测试步骤**:
1. 进入管理后台
2. 打开"评价管理"
3. 找到用户评价
4. 点击"回复"
5. 输入回复内容

**预期结果**:
- ✅ 管理员可以回复评价
- ✅ 回复显示在评价下方

---

## F011 - 消息通知

### TC-F011-001: 消息通知页面
**前置条件**: 用户已登录
**测试步骤**:
1. 进入用户中心
2. 点击"消息通知"标签

**预期结果**:
- ✅ 显示通知列表
- ✅ 未读通知有特殊标记
- ✅ 显示通知类型、内容、时间

### TC-F011-002: 通知铃铛图标
**前置条件**: 用户已登录
**测试步骤**:
1. 查看导航栏
2. 观察通知铃铛图标

**预期结果**:
- ✅ 导航栏显示通知铃铛图标
- ✅ 有未读消息时显示红点数字

### TC-F011-003: 标记已读
**前置条件**: 用户有未读通知
**测试步骤**:
1. 进入消息通知页面
2. 点击某条通知
3. 或者点击"全部已读"

**预期结果**:
- ✅ 单条通知标记为已读
- ✅ 可以一键标记全部已读
- ✅ 未读数量减少

### TC-F011-004: 删除通知
**测试步骤**:
1. 进入消息通知页面
2. 点击删除按钮

**预期结果**:
- ✅ 可以单条删除通知
- ✅ 可以批量删除通知
- ✅ 删除后从列表移除

### TC-F011-005: 订单状态变更自动通知
**前置条件**: 用户有订单
**测试步骤**:
1. 用户提交订单
2. 管理员确认订单

**预期结果**:
- ✅ 用户收到订单确认通知
- ✅ 通知显示订单号和状态

---

## F013 - 成本核算

### TC-F013-001: 成本管理页面
**前置条件**: 管理员已登录
**测试步骤**:
1. 进入管理后台
2. 点击"财务管理"

**预期结果**:
- ✅ 显示成本管理页面
- ✅ 显示成本列表
- ✅ 显示统计信息（总成本、记录数）

### TC-F013-002: 新增成本
**前置条件**: 管理员已登录
**测试步骤**:
1. 进入成本管理页面
2. 点击"新增成本"
3. 选择成本类型（房租、水电费、员工工资、维护费、采购费、其他）
4. 输入金额
5. 输入描述
6. 选择日期
7. 保存

**预期结果**:
- ✅ 弹出新增表单
- ✅ 成本类型下拉选择正常
- ✅ 金额输入验证
- ✅ 保存后显示在列表中
- ✅ 统计数据更新

### TC-F013-003: 成本筛选
**前置条件**: 有成本数据
**测试步骤**:
1. 进入成本管理页面
2. 按类型筛选
3. 按状态筛选
4. 按日期范围筛选

**预期结果**:
- ✅ 类型筛选正常工作
- ✅ 状态筛选正常工作
- ✅ 日期范围筛选正常工作
- ✅ 可以组合筛选条件

### TC-F013-004: 成本统计
**前置条件**: 有成本数据
**测试步骤**:
1. 查看成本管理页面顶部统计

**预期结果**:
- ✅ 显示当前页成本总额
- ✅ 显示记录数
- ✅ 显示总记录数
- ✅ 统计数据随筛选条件更新

### TC-F013-005: 成本编辑和删除
**前置条件**: 有成本数据
**测试步骤**:
1. 找到一条成本记录
2. 点击"编辑"
3. 修改信息并保存
4. 点击"删除"

**预期结果**:
- ✅ 可以编辑成本信息
- ✅ 可以删除成本记录
- ✅ 删除后列表更新

---

## F017 - 搜索优化

### TC-F017-001: 关键词搜索
**测试步骤**:
1. 打开搜索页面 `/#/search`
2. 在搜索框输入"beach"
3. 按回车或点击搜索

**预期结果**:
- ✅ 搜索框可用
- ✅ 输入关键词后显示相关结果
- ✅ 结果与关键词匹配

### TC-F017-002: 分类筛选
**测试步骤**:
1. 打开民宿列表页
2. 点击分类按钮（Beach、City、Villa等）
3. 观察结果变化

**预期结果**:
- ✅ 分类按钮可点击
- ✅ 选择分类后筛选结果
- ✅ 结果与分类匹配

### TC-F017-003: 高级筛选
**测试步骤**:
1. 打开搜索页面
2. 点击"Filters"按钮
3. 设置筛选条件（价格范围、设施等）
4. 应用筛选

**预期结果**:
- ✅ 筛选面板弹出
- ✅ 可以设置多个筛选条件
- ✅ 应用筛选后结果更新

### TC-F017-004: 排序功能
**测试步骤**:
1. 打开搜索结果页
2. 选择排序方式（Recommended等）

**预期结果**:
- ✅ 排序下拉菜单可用
- ✅ 选择排序后结果重新排序

### TC-F017-005: 搜索结果为空
**测试步骤**:
1. 输入不存在的关键词
2. 查看搜索结果

**预期结果**:
- ✅ 显示"暂无结果"提示
- ✅ 提供清除筛选或返回建议

---

## F018 - 收藏功能

### TC-F018-001: 收藏民宿
**前置条件**: 用户已登录
**测试步骤**:
1. 打开民宿列表页
2. 点击房源卡片上的收藏按钮（心形图标）
3. 查看按钮状态变化

**预期结果**:
- ✅ 心形按钮可点击
- ✅ 点击后按钮变为已收藏状态（填充红色）
- ✅ 显示收藏成功提示

### TC-F018-002: 取消收藏
**前置条件**: 用户已登录且已收藏该民宿
**测试步骤**:
1. 找到已收藏的民宿
2. 点击已收藏的心形按钮
3. 查看按钮状态变化

**预期结果**:
- ✅ 点击后取消收藏
- ✅ 按钮变为未收藏状态
- ✅ 显示取消收藏提示

### TC-F018-003: 我的收藏查看
**前置条件**: 用户已登录且有收藏
**测试步骤**:
1. 进入用户中心
2. 点击"我的收藏"标签

**预期结果**:
- ✅ 显示收藏的民宿列表
- ✅ 显示民宿基本信息（名称、价格、评分）
- ✅ 可以直接取消收藏

### TC-F018-004: 未登录收藏
**测试步骤**:
1. 未登录状态下点击收藏按钮

**预期结果**:
- ✅ 提示需要登录
- ✅ 跳转到登录页面
- ✅ 登录成功后返回并自动收藏

### TC-F018-005: 收藏状态同步
**前置条件**: 用户已登录
**测试步骤**:
1. 在列表页收藏民宿
2. 打开该民宿详情页
3. 查看收藏按钮状态
4. 进入用户中心查看收藏

**预期结果**:
- ✅ 列表页和详情页收藏状态一致
- ✅ 用户中心显示该收藏

---

## F019 - 多语言完善

### TC-F019-001: 语言切换菜单
**测试步骤**:
1. 打开任意页面
2. 点击导航栏语言切换按钮（如"EN"）
3. 查看菜单选项

**预期结果**:
- ✅ 语言按钮可点击
- ✅ 弹出语言选择菜单
- ✅ 显示三种语言：ไทย、English、中文

### TC-F019-002: 切换到英语
**测试步骤**:
1. 点击语言切换按钮
2. 选择"English"

**预期结果**:
- ✅ 页面语言切换为英语
- ✅ 导航栏、按钮、标签都显示英文
- ✅ 语言选择保存在localStorage

### TC-F019-003: 切换到泰语
**测试步骤**:
1. 点击语言切换按钮
2. 选择"ไทย"

**预期结果**:
- ✅ 页面语言切换为泰语
- ✅ 泰语文本正确显示

### TC-F019-004: 切换到中文
**测试步骤**:
1. 点击语言切换按钮
2. 选择"中文"

**预期结果**:
- ✅ 页面语言切换为中文
- ✅ 中文文本正确显示

### TC-F019-005: 语言切换持久化
**测试步骤**:
1. 切换到英语
2. 刷新页面

**预期结果**:
- ✅ 刷新后语言保持英语
- ✅ 语言设置被正确保存

---

## F020 - 移动端适配

### TC-F020-001: 移动端首页
**测试步骤**:
1. 使用iPhone尺寸（375x812）打开首页
2. 检查布局

**预期结果**:
- ✅ 页面正常显示无横向滚动
- ✅ 导航栏显示移动端菜单按钮
- ✅ 房源卡片单列显示

### TC-F020-002: 移动端菜单
**测试步骤**:
1. 使用移动端尺寸
2. 点击汉堡菜单按钮
3. 查看菜单内容

**预期结果**:
- ✅ 菜单按钮可点击
- ✅ 弹出移动端菜单
- ✅ 显示导航链接

### TC-F020-003: 移动端搜索
**测试步骤**:
1. 使用移动端尺寸打开搜索页
2. 点击搜索框
3. 输入搜索词

**预期结果**:
- ✅ 搜索框正常可用
- ✅ 输入不遮挡内容
- ✅ 搜索结果正常显示

### TC-F020-004: 移动端用户中心
**测试步骤**:
1. 使用移动端尺寸打开用户中心
2. 检查标签页布局

**预期结果**:
- ✅ 标签页可横向滚动或垂直堆叠
- ✅ 内容正常显示

### TC-F020-005: 触摸交互
**测试步骤**:
1. 使用移动端尺寸
2. 测试触摸滑动
3. 测试点击交互

**预期结果**:
- ✅ 触摸事件响应正常
- ✅ 按钮点击区域合适

---

## F021 - 错误边界组件

### TC-F021-001: 错误边界组件存在
**测试步骤**:
1. 检查代码文件是否存在

**预期结果**:
- ✅ ErrorBoundary.tsx 文件存在
- ✅ 已集成到 App.tsx 和 AdminApp.tsx

### TC-F021-002: 捕获渲染错误
**测试步骤**:
1. 创建一个会抛出错误的组件
2. 用 ErrorBoundary 包裹
3. 渲染该组件

**预期结果**:
- ✅ 错误被捕获
- ✅ 不显示白屏
- ✅ 显示错误边界UI

### TC-F021-003: 错误界面UI
**测试步骤**:
1. 触发错误边界
2. 查看错误界面

**预期结果**:
- ✅ 显示警告图标
- ✅ 显示"出错了"标题
- ✅ 显示错误描述
- ✅ 开发环境显示详细错误信息

### TC-F021-004: 重试功能
**测试步骤**:
1. 触发错误边界
2. 点击"重试"按钮

**预期结果**:
- ✅ 按钮可点击
- ✅ 尝试重新渲染子组件

### TC-F021-005: 返回首页功能
**测试步骤**:
1. 触发错误边界
2. 点击"返回首页"按钮

**预期结果**:
- ✅ 按钮可点击
- ✅ 导航到首页

---

## 测试执行说明

1. **测试环境**: http://localhost:5173 (前端) + http://localhost:3000 (后端)
2. **测试工具**: agent-browser CLI + Playwright MCP
3. **测试账号**:
   - 普通用户: test@example.com / password123
   - 管理员: admin / admin123
4. **浏览器**: Chromium ( headed 模式以便观察)

## 缺陷记录格式

发现的问题按以下格式记录到 Bug.md:

```markdown
## Bug-XXX: 问题标题
**功能**: FXXX - 功能名称
**严重程度**: Critical/High/Medium/Low
**状态**: Open/Fixed

**描述**:
问题详细描述

**复现步骤**:
1. 步骤1
2. 步骤2
3. 步骤3

**预期结果**:
应该发生什么

**实际结果**:
实际发生了什么

**截图**:
截图文件路径

**备注**:
其他相关信息
```
